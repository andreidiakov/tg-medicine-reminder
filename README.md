# Помощник по приему лекарств
Автор: Андрей Дьяков (10-Е)

Краткое описание:

Telegram-бот, который помогает соблюдать рекомендации по приему лекарственных средств – проблема, с которой сталкиваются 50-67% пациентов. Разработанное решение напоминает о необходимости принять лекарство, используя сообщения в популярном мессенджере – Telegram, который используют больше половины пользователей  рунета для общения по работе или с близкими. Алгоритм повторных напоминаний, звонки на сотовый номер и подтверждение приема лекарства повышают шансы на соблюдения предписанных рекомендаций.

Ключевые функции:
- удобное ведение учета домашней аптечки
- напоминания о приеме лекарств с помощью сообщений и звонков
- напоминание о своевременной покупке лекарств
- быстрая покупка лекарств
- поиск инструкций

# Технологический стек

Основа:
- основной язык программирования - python 3.9.1
- библиотека для взаимодействия с Telegram Bot API - [pyTelegramBotAPI](https://github.com/eternnoir/pyTelegramBotAPI)
- база данных - [Firebase Cloud Firestore](https://firebase.google.com/docs/firestore)

Дополнительные технологии:
- звонки и генрация голосового сообщения - [Twilio Programmable Voice](https://www.twilio.com/docs/voice)
- динамический хостинг XML (инструкции для звонков) - [Firebase Functions (Node.js 16)](https://firebase.google.com/docs/functions)

![Архитектура решения](img/архитектура.png?raw=true)

# Структура проекта
main.py - главный исходный файл программы
- инициализация бота
- создание локальных хранилищ данных
- интерфейс и обработчик главного меню

kit.py - интерфейс и обработчик меню аптечки (отображение и изменение информации о лекаствах у пользователя)

reminders.py - интерфейс и обработчик меню напоминаний (отображение, изменение и добавление напоминаний)

notifications.py - отправка уведомлений

calls.py - отправка уведомлений в виде голосового звонка

stogage.py - стуктуры данных (классы, описывающие сущности) и локальное хранилище

firestore.py - интерфей базы данных Cloud Firestore: чтение, запись, обновление, удаление

common_functions.py - общие функции, используемые другими модулями проекта

# Данные
Схема данных:

![Схема данных](img/схема_данных.png?raw=true)


# Логика работы
Логика работы интерфейса:

![Логика работы интерфейса](img/логика.png?raw=true)

# Демонстрация работы:
Видео:

# Инструкция по запуску

## Отлаживание в локальном окружении

### Запуск бота
1. Установка зависимостей ```pip3 install -r requirements.txt```
2. Создать файл .env и внести в него креденшелы и константы
```
PRODUCTION = "True / False" 

TG_TOKEN = "Токен для вашего Telegram бота"

FIREBASE_API_TOKEN = "Токен для доступа к Firebase"
FIREBASE_DB = "Ссылка на Cloud Firestore (Документоориенторованная БД на Firebase)"

TWILIO_ACCOUNT_SID = "аккаунт twilio"
TWILIO_AUTH_TOKEN = "токен для работы с аккаунтом"
TWILIO_PHONE = "номер телефона"

GET_XML_CLOUDFUNCTION = "облачная функция для генерации XML (инструкции для звонка)"
```
3. ```python main.py```

### Запуск функции

1. Первоначальная настройка ([инструкции по первоначальной настройке](https://firebase.google.com/docs/functions/get-started))
```
cd "cloud functions"
npm install -g firebase-tools
npm install
firebase login
```
2. Запуск ```firebase emulators:start```

## Развертывание на продакшене

Программа самого бота размещается на виртуальном выделенном сервере Heroku Dyno, команда деплоя:

```
git push heroku master
```

Предварительно необходимо выполнить [инструкции по первоначальной настройки, создать проект и внести настройки проекта переменные окружения (креденшелы и константы)](https://towardsdatascience.com/how-to-deploy-a-telegram-bot-using-heroku-for-free-9436f89575d2).

Функция для динамического хостинга XML размещается на платформе облачных вычислений Firebase, команда деплоя:
```
firebase deploy --only functions
```
